"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7043],{7043:(N,u,r)=>{r.r(u),r.d(u,{SearchRoutePageModule:()=>P});var m=r(177),a=r(4341),c=r(4742),g=r(8986),d=r(467),t=r(3953),p=r(7692),f=r(3656),M=r(4132);const v=["originInput"],k=["destinationInput"];function R(s,b){1&s&&(t.j41(0,"div"),t.nrm(1,"div",13),t.k0s())}const F=[{path:"",component:(()=>{class s{constructor(e,i,o,n){this.fb=e,this.generalService=i,this.cd=o,this.navCtrl=n,this.notificationMessage="",this.notificationType="info",this.isNotificationVisible=!1,this.showMap=!1,this.searchForm=this.fb.group({startLocation:["",a.k0.required],endLocation:["",a.k0.required],startDate:["",a.k0.required],startTime:["",a.k0.required]}),this.directionsService=new google.maps.DirectionsService,this.directionsRenderer=new google.maps.DirectionsRenderer}ngAfterViewInit(){this.initAutocomplete()}initMap(){const e=document.getElementById("map");e?(this.map=new google.maps.Map(e,{center:{lat:14.634915,lng:-90.506882},zoom:12}),this.directionsRenderer.setMap(this.map)):console.error("El contenedor del mapa no existe en el DOM")}initAutocomplete(){var e=this;return(0,d.A)(function*(){const i=yield e.originInput.getInputElement(),o=yield e.destinationInput.getInputElement();e.setupAutocomplete(i,"origin"),e.setupAutocomplete(o,"destination")})()}setupAutocomplete(e,i){const o=new google.maps.places.Autocomplete(e,{componentRestrictions:{country:"GT"}});o.addListener("place_changed",()=>{const n=o.getPlace();!n.geometry||!n.geometry.location||("origin"===i?(this.setMarker("origin",n.geometry.location),this.searchForm.patchValue({startLocation:n.formatted_address})):"destination"===i&&(this.setMarker("destination",n.geometry.location),this.searchForm.patchValue({endLocation:n.formatted_address})),this.originMarker&&this.destinationMarker&&(this.showMap=!0,this.cd.detectChanges(),this.initMap(),this.traceRoute()))})}setMarker(e,i){"origin"===e?this.originMarker?this.originMarker.setPosition(i):this.originMarker=new google.maps.Marker({position:i,map:this.map,title:"Origen"}):"destination"===e&&(this.destinationMarker?this.destinationMarker.setPosition(i):this.destinationMarker=new google.maps.Marker({position:i,map:this.map,title:"Destino"}))}traceRoute(){const o={origin:this.originMarker.getPosition(),destination:this.destinationMarker.getPosition(),travelMode:google.maps.TravelMode.DRIVING};this.directionsService.route(o,(n,l)=>{l===google.maps.DirectionsStatus.OK?this.directionsRenderer.setDirections(n):this.showNotification("Error al trazar la ruta","error")})}showNotification(e,i){console.log("Notificaci\xf3n:",e,i),this.notificationMessage=e,this.notificationType=i,this.isNotificationVisible=!0,setTimeout(()=>{this.notificationMessage=""},3e3)}onSearchRoute(){if(this.searchForm.valid){this.searchForm.get("startLocation"),this.searchForm.get("endLocation");const o=this.searchForm.get("startDate")?.value,n=this.searchForm.get("startTime")?.value,l={latitudInicio:this.originMarker.getPosition().lat(),longitudInicio:this.originMarker.getPosition().lng(),latitudDestino:this.destinationMarker.getPosition().lat(),longitudDestino:this.destinationMarker.getPosition().lng(),fechaViaje:o,horaViaje:n+":00"};console.log("Par\xe1metros de b\xfasqueda:",l),this.generalService.get("api/searchRoutes",l).subscribe({next:h=>{console.log("Rutas encontradas:",h),h.length>0?this.navCtrl.navigateForward("/search-results",{queryParams:{routes:JSON.stringify(h)}}):(console.log("No se encontraron rutas"),this.showNotification("No se encontraron rutas","warning"))},error:h=>{console.error("Error al buscar rutas",h),this.showNotification("Error al buscar rutas","error")}})}else this.showNotification("Por favor, complete todos los campos","error")}static#t=this.\u0275fac=function(i){return new(i||s)(t.rXU(a.ok),t.rXU(p.O),t.rXU(t.gRc),t.rXU(f.q9))};static#i=this.\u0275cmp=t.VBU({type:s,selectors:[["app-search-route"]],viewQuery:function(i,o){if(1&i&&(t.GBs(v,5),t.GBs(k,5)),2&i){let n;t.mGM(n=t.lsd())&&(o.originInput=n.first),t.mGM(n=t.lsd())&&(o.destinationInput=n.first)}},decls:30,vars:5,consts:[["originInput",""],["destinationInput",""],["slot","start"],[1,"ion-padding"],[3,"message","type","isVisible"],[3,"formGroup"],["position","floating"],["formControlName","startLocation","type","text"],["formControlName","endLocation","type","text"],["formControlName","startDate","type","date"],["formControlName","startTime","type","time"],["expand","full",3,"click"],[4,"ngIf"],["id","map",2,"height","400px","width","100%"]],template:function(i,o){if(1&i){const n=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),t.nrm(3,"ion-back-button"),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Buscar Rutas"),t.k0s()()(),t.j41(6,"ion-content",3),t.nrm(7,"app-notification",4),t.j41(8,"form",5)(9,"ion-item")(10,"ion-label",6),t.EFF(11,"Punto de Origen"),t.k0s(),t.nrm(12,"ion-input",7,0),t.k0s(),t.j41(14,"ion-item")(15,"ion-label",6),t.EFF(16,"Punto de Destino"),t.k0s(),t.nrm(17,"ion-input",8,1),t.k0s(),t.j41(19,"ion-item")(20,"ion-label",6),t.EFF(21,"Fecha"),t.k0s(),t.nrm(22,"ion-input",9),t.k0s(),t.j41(23,"ion-item")(24,"ion-label",6),t.EFF(25,"Hora"),t.k0s(),t.nrm(26,"ion-input",10),t.k0s(),t.j41(27,"ion-button",11),t.bIt("click",function(){return t.eBV(n),t.Njj(o.onSearchRoute())}),t.EFF(28,"Buscar Ruta"),t.k0s()(),t.DNE(29,R,2,0,"div",12),t.k0s()}2&i&&(t.R7$(7),t.Y8G("message",o.notificationMessage)("type",o.notificationType)("isVisible",o.isNotificationVisible),t.R7$(),t.Y8G("formGroup",o.searchForm),t.R7$(21),t.Y8G("ngIf",o.showMap))},dependencies:[m.bT,a.qT,a.BC,a.cb,c.Jm,c.QW,c.W9,c.eU,c.$w,c.uz,c.he,c.BC,c.ai,c.Gw,c.el,M.z,a.j4,a.JD]})}return s})()}];let y=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#i=this.\u0275mod=t.$C({type:s});static#e=this.\u0275inj=t.G2t({imports:[g.iI.forChild(F),g.iI]})}return s})();var I=r(3887);let P=(()=>{class s{static#t=this.\u0275fac=function(i){return new(i||s)};static#i=this.\u0275mod=t.$C({type:s});static#e=this.\u0275inj=t.G2t({imports:[m.MD,a.YN,c.bv,y,I.G,a.X1]})}return s})()}}]);