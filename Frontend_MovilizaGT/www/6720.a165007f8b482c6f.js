"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6720],{4339:(D,g,l)=>{l.r(g),l.d(g,{ConductorTripsPageModule:()=>O});var _=l(177),u=l(4341),a=l(4742),m=l(8986),f=l(7586),t=l(3953),F=l(7692),C=l(92);const h=()=>[0,1,2,3,4,5];function P(i,c){1&i&&(t.j41(0,"span"),t.EFF(1,"Pendiente"),t.k0s())}function E(i,c){1&i&&(t.j41(0,"span"),t.EFF(1,"Aprobada"),t.k0s())}function T(i,c){1&i&&(t.j41(0,"span"),t.EFF(1,"Rechazada"),t.k0s())}function j(i,c){if(1&i&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Foto del Pasajero:"),t.k0s(),t.nrm(3,"img",12),t.k0s()),2&i){const o=t.XpG(3).$implicit;t.R7$(3),t.Y8G("src",o.user.photo,t.B4B)}}function k(i,c){1&i&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Foto del Pasajero:"),t.k0s(),t.EFF(3," No disponible "),t.k0s())}function I(i,c){if(1&i&&(t.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),t.EFF(3,"Datos del Pasajero"),t.k0s()(),t.j41(4,"ion-card-content")(5,"p")(6,"strong"),t.EFF(7,"Tel\xe9fono:"),t.k0s(),t.EFF(8),t.k0s(),t.j41(9,"p")(10,"strong"),t.EFF(11,"Email:"),t.k0s(),t.EFF(12),t.k0s(),t.j41(13,"p")(14,"strong"),t.EFF(15,"G\xe9nero:"),t.k0s(),t.EFF(16),t.k0s(),t.j41(17,"p")(18,"strong"),t.EFF(19,"Edad:"),t.k0s(),t.EFF(20),t.k0s(),t.j41(21,"p")(22,"strong"),t.EFF(23,"Estado de cuenta:"),t.k0s(),t.DNE(24,P,2,0,"span",6)(25,E,2,0,"span",6)(26,T,2,0,"span",6),t.k0s(),t.DNE(27,j,4,1,"p",6)(28,k,4,0,"p",6),t.k0s()()),2&i){const o=t.XpG(2).$implicit;t.R7$(8),t.SpI(" ",o.user.phone,""),t.R7$(4),t.SpI(" ",o.user.email,""),t.R7$(4),t.SpI(" ",o.user.gender,""),t.R7$(4),t.SpI(" ",o.user.age,""),t.R7$(4),t.Y8G("ngIf",0===o.user.accountStatus),t.R7$(),t.Y8G("ngIf",1===o.user.accountStatus),t.R7$(),t.Y8G("ngIf",2===o.user.accountStatus),t.R7$(),t.Y8G("ngIf",o.user.photo),t.R7$(),t.Y8G("ngIf",!o.user.photo)}}function M(i,c){if(1&i){const o=t.RV6();t.j41(0,"div")(1,"ion-button",8),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.toggleConductorDetails(n))}),t.EFF(2),t.k0s(),t.DNE(3,I,29,9,"ion-card",6),t.j41(4,"ion-item")(5,"ion-label",9),t.EFF(6,"Precio Acordado"),t.k0s(),t.j41(7,"ion-input",10),t.mxI("ngModelChange",function(n){t.eBV(o);const s=t.XpG().$implicit;return t.DH7(s.agreedPrice,n)||(s.agreedPrice=n),t.Njj(n)}),t.k0s()(),t.j41(8,"ion-button",11),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.acceptTrip(n))}),t.EFF(9,"Aceptar Viaje"),t.k0s()()}if(2&i){const o=t.XpG().$implicit;t.R7$(2),t.SpI(" ",o.showConductorDetails?"Ocultar":"Mostrar"," Datos del Pasajero "),t.R7$(),t.Y8G("ngIf",o.showConductorDetails),t.R7$(4),t.R50("ngModel",o.agreedPrice)}}function v(i,c){if(1&i&&(t.j41(0,"ion-select-option",16),t.EFF(1),t.k0s()),2&i){const o=c.$implicit;t.Y8G("value",o),t.R7$(),t.JRh(o)}}function b(i,c){if(1&i){const o=t.RV6();t.j41(0,"div")(1,"ion-item")(2,"ion-label"),t.EFF(3,"Calificaci\xf3n"),t.k0s(),t.j41(4,"ion-select",13),t.mxI("ngModelChange",function(n){t.eBV(o);const s=t.XpG().$implicit;return t.DH7(s.calificationScore,n)||(s.calificationScore=n),t.Njj(n)}),t.DNE(5,v,2,2,"ion-select-option",14),t.k0s()(),t.j41(6,"ion-item")(7,"ion-label",9),t.EFF(8,"Comentario"),t.k0s(),t.j41(9,"ion-textarea",13),t.mxI("ngModelChange",function(n){t.eBV(o);const s=t.XpG().$implicit;return t.DH7(s.calificationComment,n)||(s.calificationComment=n),t.Njj(n)}),t.k0s()(),t.j41(10,"ion-button",15),t.bIt("click",function(){t.eBV(o);const n=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.submitCalification(n))}),t.EFF(11,"Enviar Calificaci\xf3n"),t.k0s()()}if(2&i){const o=t.XpG().$implicit;t.R7$(4),t.R50("ngModel",o.calificationScore),t.R7$(),t.Y8G("ngForOf",t.lJ4(3,h)),t.R7$(4),t.R50("ngModel",o.calificationComment)}}function S(i,c){if(1&i&&(t.j41(0,"ion-item")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),t.EFF(4),t.k0s()(),t.j41(5,"ion-card-content")(6,"p")(7,"strong"),t.EFF(8,"Fecha de inicio:"),t.k0s(),t.EFF(9),t.k0s(),t.j41(10,"p")(11,"strong"),t.EFF(12,"Fecha de fin:"),t.k0s(),t.EFF(13),t.k0s(),t.j41(14,"p")(15,"strong"),t.EFF(16,"Asientos solicitados:"),t.k0s(),t.EFF(17),t.k0s(),t.j41(18,"p")(19,"strong"),t.EFF(20,"Precio Acordado:"),t.k0s(),t.EFF(21),t.k0s(),t.j41(22,"p")(23,"strong"),t.EFF(24,"Estado del viaje:"),t.k0s(),t.EFF(25),t.k0s(),t.DNE(26,M,10,3,"div",6)(27,b,12,4,"div",6),t.k0s()()()),2&i){const o=c.$implicit,e=t.XpG(2);t.R7$(4),t.SpI("Viaje con ",o.route.person.fullName,""),t.R7$(5),t.SpI(" ",o.tripStart,""),t.R7$(4),t.SpI(" ",o.tripEnd,""),t.R7$(4),t.SpI(" ",o.neededSeats,""),t.R7$(4),t.SpI(" ",o.agreedPrice,""),t.R7$(4),t.SpI(" ",o.statusTrip,""),t.R7$(),t.Y8G("ngIf","solicitado"===o.statusTrip),t.R7$(),t.Y8G("ngIf",e.isTripCompleted(o))}}function x(i,c){if(1&i&&(t.j41(0,"ion-list"),t.DNE(1,S,28,8,"ion-item",7),t.k0s()),2&i){const o=t.XpG();t.R7$(),t.Y8G("ngForOf",o.trips)}}function R(i,c){1&i&&(t.j41(0,"ion-label"),t.EFF(1,"No se encontraron viajes."),t.k0s())}const $=[{path:"",component:(()=>{class i{constructor(o,e){this.generalService=o,this.appComponent=e,this.trips=[],this.notificationMessage="",this.notificationType="info",this.isNotificationVisible=!1,this.selectedStatus="pendiente",this.geocoder=new google.maps.Geocoder}ngOnInit(){const o=sessionStorage.getItem("userData");if(o){const n=JSON.parse(o).userId;this.loadconductorTrips(n)}}onStatusChange(o){const e=sessionStorage.getItem("userData");if(e){const s=JSON.parse(e).userId;this.loadconductorTrips(s,this.selectedStatus)}}loadconductorTrips(o,e="pendiente"){this.generalService.get("api/tripsByRouteCreator",{userIdCreator:o,statusTrip:e}).subscribe({next:s=>{this.trips=s,this.trips.forEach(r=>{this.getPlaceNameFromCoordinates(r.startPoints.split(",")[0],r.startPoints.split(",")[1],"startLocation",r),this.getPlaceNameFromCoordinates(r.endPoints.split(",")[0],r.endPoints.split(",")[1],"endLocation",r)})},error:s=>{console.error("Error al cargar los viajes solicitados:",s)}})}getPlaceNameFromCoordinates(o,e,n,s){const r={lat:parseFloat(o+""),lng:parseFloat(e+"")};this.geocoder.geocode({location:r},(d,p)=>{"OK"===p&&d[0]?s[n]=d[0].formatted_address:(console.error("Error al obtener el nombre del lugar:",p),s[n]=`${o}, ${e}`)})}showNotification(o,e){this.notificationMessage=o,this.notificationType=e,this.isNotificationVisible=!0,setTimeout(()=>{this.isNotificationVisible=!1},6e3)}isTripCompleted(o){const e=f(o.tripEnd),n=f();return"aceptado"===o.statusTrip&&e.isBefore(n)}submitCalification(o){const e=sessionStorage.getItem("userData");if(e){const s=JSON.parse(e).userId;this.generalService.post("api/createQualification",{score:o.calificationScore||0,message:o.calificationComment||"",FK_userId1:s,FK_userId2:o.user.userId,FK_tripId:o.tripId}).subscribe({next:p=>{console.log("Calificaci\xf3n enviada exitosamente:",p),this.showNotification("Calificaci\xf3n enviada exitosamente","success"),this.appComponent.showNotification("Calificaci\xf3n enviada exitosamente","success")},error:p=>{console.error("Error al enviar la calificaci\xf3n:",p),this.showNotification("Error al enviar la calificaci\xf3n","error"),this.appComponent.showNotification("Error al enviar la calificaci\xf3n","error")}})}}toggleConductorDetails(o){o.showConductorDetails=!o.showConductorDetails}acceptTrip(o){this.generalService.post("api/updateTripStatus",{estado:"3",precio:o.agreedPrice,viajeId:o.tripId}).subscribe({next:n=>{n.success?(this.showNotification(n.message,"success"),this.appComponent.showNotification(n.message,"success"),o.statusTrip="aceptado"):this.appComponent.showNotification(n.message,"error")},error:n=>{console.error("Error al aceptar el viaje:",n),this.showNotification("Error al aceptar el viaje","error")}})}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(F.O),t.rXU(C.Z))};static#o=this.\u0275cmp=t.VBU({type:i,selectors:[["app-conductor-trips"]],decls:19,vars:3,consts:[["slot","start"],[1,"ion-padding"],[3,"ngModelChange","ionChange","ngModel"],["value","pendiente"],["value","solicitado"],["value","aceptado"],[4,"ngIf"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",3,"click"],["position","floating"],["type","number",3,"ngModelChange","ngModel"],["expand","full","color","success",3,"click"],["alt","Foto del pasajero",2,"width","100px","height","100px",3,"src"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["expand","full",3,"click"],[3,"value"]],template:function(e,n){1&e&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t.nrm(3,"ion-back-button"),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Mis Viajes como Conductor"),t.k0s()()(),t.j41(6,"ion-content",1)(7,"ion-item")(8,"ion-label"),t.EFF(9,"Filtrar por estado"),t.k0s(),t.j41(10,"ion-select",2),t.mxI("ngModelChange",function(r){return t.DH7(n.selectedStatus,r)||(n.selectedStatus=r),r}),t.bIt("ionChange",function(r){return n.onStatusChange(r)}),t.j41(11,"ion-select-option",3),t.EFF(12,"Pendiente"),t.k0s(),t.j41(13,"ion-select-option",4),t.EFF(14,"Solicitado"),t.k0s(),t.j41(15,"ion-select-option",5),t.EFF(16,"Aceptado"),t.k0s()()(),t.DNE(17,x,2,1,"ion-list",6)(18,R,2,0,"ion-label",6),t.k0s()),2&e&&(t.R7$(10),t.R50("ngModel",n.selectedStatus),t.R7$(7),t.Y8G("ngIf",n.trips.length>0),t.R7$(),t.Y8G("ngIf",0===n.trips.length))},dependencies:[_.Sq,_.bT,u.BC,u.vS,a.Jm,a.QW,a.b_,a.I9,a.ME,a.tN,a.W9,a.eU,a.$w,a.uz,a.he,a.nf,a.Nm,a.Ip,a.nc,a.BC,a.ai,a.su,a.Je,a.Gw,a.el],styles:["ion-content[_ngcontent-%COMP%]{background-color:#f2f2f2}ion-content[_ngcontent-%COMP%]   .ion-list[_ngcontent-%COMP%]{margin-bottom:1rem}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{background-color:#3d3d4c;color:#fff;border-radius:12px;box-shadow:0 4px 6px #0000001a;margin:10px;padding:10px}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background-color:#232329;border-radius:12px 12px 0 0;padding:12px}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#f5f3f0}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{font-size:1rem;color:#e0e0e0;padding:8px 12px;line-height:1.5}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e8e7e3;font-weight:700}ion-content[_ngcontent-%COMP%]   .ion-label[_ngcontent-%COMP%]{color:#a9a9a9;font-size:1.2rem;text-align:center;margin-top:20px}"]})}return i})()}];let N=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#o=this.\u0275mod=t.$C({type:i});static#i=this.\u0275inj=t.G2t({imports:[m.iI.forChild($),m.iI]})}return i})();var G=l(3887);let O=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#o=this.\u0275mod=t.$C({type:i});static#i=this.\u0275inj=t.G2t({imports:[_.MD,u.YN,a.bv,N,G.G]})}return i})()}}]);