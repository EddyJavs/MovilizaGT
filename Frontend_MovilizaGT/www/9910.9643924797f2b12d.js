"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9910],{9910:(O,u,l)=>{l.r(u),l.d(u,{PassengerTripsPageModule:()=>G});var d=l(177),g=l(4341),a=l(4742),m=l(8986),f=l(7586),t=l(3953),F=l(7692),h=l(92);const P=()=>[0,1,2,3,4,5];function C(n,c){1&n&&(t.j41(0,"span"),t.EFF(1,"Pendiente"),t.k0s())}function E(n,c){1&n&&(t.j41(0,"span"),t.EFF(1,"Aprobada"),t.k0s())}function T(n,c){1&n&&(t.j41(0,"span"),t.EFF(1,"Rechazada"),t.k0s())}function j(n,c){if(1&n&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Foto del Conductor:"),t.k0s(),t.nrm(3,"img",12),t.k0s()),2&n){const e=t.XpG(3).$implicit;t.R7$(3),t.Y8G("src",e.route.person.photo,t.B4B)}}function k(n,c){1&n&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Foto del Conductor:"),t.k0s(),t.EFF(3," No disponible "),t.k0s())}function I(n,c){if(1&n&&(t.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),t.EFF(3,"Datos del Conductor"),t.k0s()(),t.j41(4,"ion-card-content")(5,"p")(6,"strong"),t.EFF(7,"Tel\xe9fono:"),t.k0s(),t.EFF(8),t.k0s(),t.j41(9,"p")(10,"strong"),t.EFF(11,"Email:"),t.k0s(),t.EFF(12),t.k0s(),t.j41(13,"p")(14,"strong"),t.EFF(15,"G\xe9nero:"),t.k0s(),t.EFF(16),t.k0s(),t.j41(17,"p")(18,"strong"),t.EFF(19,"Edad:"),t.k0s(),t.EFF(20),t.k0s(),t.j41(21,"p")(22,"strong"),t.EFF(23,"Estado de cuenta:"),t.k0s(),t.DNE(24,C,2,0,"span",6)(25,E,2,0,"span",6)(26,T,2,0,"span",6),t.k0s(),t.DNE(27,j,4,1,"p",6)(28,k,4,0,"p",6),t.k0s()()),2&n){const e=t.XpG(2).$implicit;t.R7$(8),t.SpI(" ",e.route.person.phone,""),t.R7$(4),t.SpI(" ",e.route.person.email,""),t.R7$(4),t.SpI(" ",e.route.person.gender,""),t.R7$(4),t.SpI(" ",e.route.person.age,""),t.R7$(4),t.Y8G("ngIf",0===e.route.person.accountStatus),t.R7$(),t.Y8G("ngIf",1===e.route.person.accountStatus),t.R7$(),t.Y8G("ngIf",2===e.route.person.accountStatus),t.R7$(),t.Y8G("ngIf",e.route.person.photo),t.R7$(),t.Y8G("ngIf",!e.route.person.photo)}}function M(n,c){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"ion-button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.toggleConductorDetails(i))}),t.EFF(2),t.k0s(),t.DNE(3,I,29,9,"ion-card",6),t.j41(4,"ion-item")(5,"ion-label",9),t.EFF(6,"Precio Acordado"),t.k0s(),t.j41(7,"ion-input",10),t.mxI("ngModelChange",function(i){t.eBV(e);const s=t.XpG().$implicit;return t.DH7(s.agreedPrice,i)||(s.agreedPrice=i),t.Njj(i)}),t.k0s()(),t.j41(8,"ion-button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.acceptTrip(i))}),t.EFF(9,"Aceptar Viaje"),t.k0s()()}if(2&n){const e=t.XpG().$implicit;t.R7$(2),t.SpI(" ",e.showConductorDetails?"Ocultar":"Mostrar"," Datos del Conductor "),t.R7$(),t.Y8G("ngIf",e.showConductorDetails),t.R7$(4),t.R50("ngModel",e.agreedPrice)}}function v(n,c){if(1&n&&(t.j41(0,"ion-select-option",16),t.EFF(1),t.k0s()),2&n){const e=c.$implicit;t.Y8G("value",e),t.R7$(),t.JRh(e)}}function S(n,c){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"ion-item")(2,"ion-label"),t.EFF(3,"Calificaci\xf3n"),t.k0s(),t.j41(4,"ion-select",13),t.mxI("ngModelChange",function(i){t.eBV(e);const s=t.XpG().$implicit;return t.DH7(s.calificationScore,i)||(s.calificationScore=i),t.Njj(i)}),t.DNE(5,v,2,2,"ion-select-option",14),t.k0s()(),t.j41(6,"ion-item")(7,"ion-label",9),t.EFF(8,"Comentario"),t.k0s(),t.j41(9,"ion-textarea",13),t.mxI("ngModelChange",function(i){t.eBV(e);const s=t.XpG().$implicit;return t.DH7(s.calificationComment,i)||(s.calificationComment=i),t.Njj(i)}),t.k0s()(),t.j41(10,"ion-button",15),t.bIt("click",function(){t.eBV(e);const i=t.XpG().$implicit,s=t.XpG(2);return t.Njj(s.submitCalification(i))}),t.EFF(11,"Enviar Calificaci\xf3n"),t.k0s()()}if(2&n){const e=t.XpG().$implicit;t.R7$(4),t.R50("ngModel",e.calificationScore),t.R7$(),t.Y8G("ngForOf",t.lJ4(3,P)),t.R7$(4),t.R50("ngModel",e.calificationComment)}}function b(n,c){if(1&n&&(t.j41(0,"ion-item")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),t.EFF(4),t.k0s()(),t.j41(5,"ion-card-content")(6,"p")(7,"strong"),t.EFF(8,"Desde:"),t.k0s(),t.EFF(9),t.k0s(),t.j41(10,"p")(11,"strong"),t.EFF(12,"Hasta:"),t.k0s(),t.EFF(13),t.k0s(),t.j41(14,"p")(15,"strong"),t.EFF(16,"Fecha de inicio:"),t.k0s(),t.EFF(17),t.k0s(),t.j41(18,"p")(19,"strong"),t.EFF(20,"Fecha de fin:"),t.k0s(),t.EFF(21),t.k0s(),t.j41(22,"p")(23,"strong"),t.EFF(24,"Asientos solicitados:"),t.k0s(),t.EFF(25),t.k0s(),t.j41(26,"p")(27,"strong"),t.EFF(28,"Estado del viaje:"),t.k0s(),t.EFF(29),t.k0s(),t.DNE(30,M,10,3,"div",6)(31,S,12,4,"div",6),t.k0s()()()),2&n){const e=c.$implicit,o=t.XpG(2);t.R7$(4),t.SpI("Viaje con ",e.route.person.fullName,""),t.R7$(5),t.SpI(" ",e.startLocation,""),t.R7$(4),t.SpI(" ",e.endLocation,""),t.R7$(4),t.SpI(" ",e.tripStart,""),t.R7$(4),t.SpI(" ",e.tripEnd,""),t.R7$(4),t.SpI(" ",e.neededSeats,""),t.R7$(4),t.SpI(" ",e.statusTrip,""),t.R7$(),t.Y8G("ngIf","solicitado"===e.statusTrip),t.R7$(),t.Y8G("ngIf",o.isTripCompleted(e))}}function x(n,c){if(1&n&&(t.j41(0,"ion-list"),t.DNE(1,b,32,9,"ion-item",7),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.trips)}}function R(n,c){1&n&&(t.j41(0,"ion-label"),t.EFF(1,"No se encontraron viajes."),t.k0s())}const $=[{path:"",component:(()=>{class n{constructor(e,o){this.generalService=e,this.appComponent=o,this.trips=[],this.notificationMessage="",this.notificationType="info",this.isNotificationVisible=!1,this.selectedStatus="pendiente",this.geocoder=new google.maps.Geocoder}ngOnInit(){const e=sessionStorage.getItem("userData");if(e){const i=JSON.parse(e).userId;this.loadPassengerTrips(i)}}onStatusChange(e){const o=sessionStorage.getItem("userData");if(o){const s=JSON.parse(o).userId;this.loadPassengerTrips(s,this.selectedStatus)}}loadPassengerTrips(e,o="pendiente"){this.generalService.get("api/tripsByTripCreator",{userIdCreator:e,statusTrip:o}).subscribe({next:s=>{this.trips=s,this.trips.forEach(r=>{this.getPlaceNameFromCoordinates(r.startPoints.split(",")[0],r.startPoints.split(",")[1],"startLocation",r),this.getPlaceNameFromCoordinates(r.endPoints.split(",")[0],r.endPoints.split(",")[1],"endLocation",r)})},error:s=>{console.error("Error al cargar los viajes solicitados:",s)}})}getPlaceNameFromCoordinates(e,o,i,s){const r={lat:parseFloat(e+""),lng:parseFloat(o+"")};this.geocoder.geocode({location:r},(_,p)=>{"OK"===p&&_[0]?s[i]=_[0].formatted_address:(console.error("Error al obtener el nombre del lugar:",p),s[i]=`${e}, ${o}`)})}showNotification(e,o){this.notificationMessage=e,this.notificationType=o,this.isNotificationVisible=!0,setTimeout(()=>{this.isNotificationVisible=!1},6e3)}isTripCompleted(e){const o=f(e.tripEnd),i=f();return"aceptado"===e.statusTrip&&o.isBefore(i)}submitCalification(e){const o=sessionStorage.getItem("userData");if(o){const s=JSON.parse(o).userId;this.generalService.post("api/createQualification",{score:e.calificationScore||0,message:e.calificationComment||"",FK_userId1:s,FK_userId2:e.route.person.userId,FK_tripId:e.tripId}).subscribe({next:p=>{console.log("Calificaci\xf3n enviada exitosamente:",p),this.showNotification("Calificaci\xf3n enviada exitosamente","success"),this.appComponent.showNotification("Calificaci\xf3n enviada exitosamente","success")},error:p=>{console.error("Error al enviar la calificaci\xf3n:",p),this.showNotification("Error al enviar la calificaci\xf3n","error"),this.appComponent.showNotification("Error al enviar la calificaci\xf3n","error")}})}}toggleConductorDetails(e){e.showConductorDetails=!e.showConductorDetails}acceptTrip(e){this.generalService.post("api/updateTripStatus",{estado:"3",precio:e.agreedPrice,viajeId:e.tripId}).subscribe({next:i=>{i.success&&(this.showNotification(i.message,"success"),this.appComponent.showNotification(i.message,"success"),e.statusTrip="aceptado")},error:i=>{console.error("Error al aceptar el viaje:",i),this.showNotification("Error al aceptar el viaje","error")}})}static#t=this.\u0275fac=function(o){return new(o||n)(t.rXU(F.O),t.rXU(h.Z))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["app-passenger-trips"]],decls:19,vars:3,consts:[["slot","start"],[1,"ion-padding"],[3,"ngModelChange","ionChange","ngModel"],["value","pendiente"],["value","solicitado"],["value","aceptado"],[4,"ngIf"],[4,"ngFor","ngForOf"],["expand","block","fill","outline",3,"click"],["position","floating"],["type","number",3,"ngModelChange","ngModel"],["expand","full","color","success",3,"click"],["alt","Foto del conductor",2,"width","100px","height","100px",3,"src"],[3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["expand","full",3,"click"],[3,"value"]],template:function(o,i){1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t.nrm(3,"ion-back-button"),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Mis Viajes como Pasajero"),t.k0s()()(),t.j41(6,"ion-content",1)(7,"ion-item")(8,"ion-label"),t.EFF(9,"Estado del viaje"),t.k0s(),t.j41(10,"ion-select",2),t.mxI("ngModelChange",function(r){return t.DH7(i.selectedStatus,r)||(i.selectedStatus=r),r}),t.bIt("ionChange",function(r){return i.onStatusChange(r)}),t.j41(11,"ion-select-option",3),t.EFF(12,"Pendiente"),t.k0s(),t.j41(13,"ion-select-option",4),t.EFF(14,"Solicitado"),t.k0s(),t.j41(15,"ion-select-option",5),t.EFF(16,"Aceptado"),t.k0s()()(),t.DNE(17,x,2,1,"ion-list",6)(18,R,2,0,"ion-label",6),t.k0s()),2&o&&(t.R7$(10),t.R50("ngModel",i.selectedStatus),t.R7$(7),t.Y8G("ngIf",i.trips.length>0),t.R7$(),t.Y8G("ngIf",0===i.trips.length))},dependencies:[d.Sq,d.bT,g.BC,g.vS,a.Jm,a.QW,a.b_,a.I9,a.ME,a.tN,a.W9,a.eU,a.$w,a.uz,a.he,a.nf,a.Nm,a.Ip,a.nc,a.BC,a.ai,a.su,a.Je,a.Gw,a.el],styles:["ion-content[_ngcontent-%COMP%]{background-color:#f2f2f2}ion-content[_ngcontent-%COMP%]   .ion-list[_ngcontent-%COMP%]{margin-bottom:1rem}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]{background-color:#3d3d4c;color:#fff;border-radius:12px;box-shadow:0 4px 6px #0000001a;margin:10px;padding:10px}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{background-color:#232329;border-radius:12px 12px 0 0;padding:12px}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#f5f3f0}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{font-size:1rem;color:#e0e0e0;padding:8px 12px;line-height:1.5}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:5px 0}ion-content[_ngcontent-%COMP%]   ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:#e8e7e3;font-weight:700}ion-content[_ngcontent-%COMP%]   .ion-label[_ngcontent-%COMP%]{color:#a9a9a9;font-size:1.2rem;text-align:center;margin-top:20px}"]})}return n})()}];let N=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.$C({type:n});static#n=this.\u0275inj=t.G2t({imports:[m.iI.forChild($),m.iI]})}return n})();var D=l(3887);let G=(()=>{class n{static#t=this.\u0275fac=function(o){return new(o||n)};static#e=this.\u0275mod=t.$C({type:n});static#n=this.\u0275inj=t.G2t({imports:[d.MD,g.YN,a.bv,N,D.G]})}return n})()}}]);