"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3420],{3420:(O,f,r)=>{r.r(f),r.d(f,{SearchResultsPageModule:()=>D});var g=r(177),u=r(4341),a=r(4742),p=r(8986),S=r(7586),e=r(3953),v=r(7692),P=r(3656),I=r(92),R=r(4132);function M(n,d){if(1&n){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.EFF(4),e.k0s()(),e.j41(5,"ion-card-content")(6,"p")(7,"strong"),e.EFF(8,"Calificaci\xf3n Media:"),e.k0s(),e.EFF(9),e.k0s(),e.j41(10,"p")(11,"strong"),e.EFF(12,"Fecha:"),e.k0s(),e.EFF(13),e.j41(14,"strong"),e.EFF(15,"Hora:"),e.k0s(),e.EFF(16),e.k0s(),e.j41(17,"p")(18,"strong"),e.EFF(19,"Veh\xedculo:"),e.k0s(),e.EFF(20),e.k0s(),e.j41(21,"p")(22,"strong"),e.EFF(23,"Asientos disponibles:"),e.k0s(),e.EFF(24),e.k0s(),e.j41(25,"p")(26,"strong"),e.EFF(27,"Desde:"),e.k0s(),e.EFF(28),e.k0s(),e.j41(29,"p")(30,"strong"),e.EFF(31,"Hasta:"),e.k0s(),e.EFF(32),e.k0s(),e.nrm(33,"div",4),e.j41(34,"ion-item")(35,"ion-label",5),e.EFF(36,"Asientos requeridos"),e.k0s(),e.j41(37,"ion-input",6),e.mxI("ngModelChange",function(i){const s=e.eBV(t).$implicit;return e.DH7(s.neededSeats,i)||(s.neededSeats=i),e.Njj(i)}),e.k0s()(),e.j41(38,"ion-button",7),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.requestTrip(i))}),e.EFF(39," Solicitar Viaje "),e.k0s()()()()}if(2&n){const t=d.$implicit,o=d.index;e.R7$(4),e.SpI("Ruta de ",t.driverName,""),e.R7$(5),e.SpI(" ",t.calificacion," "),e.R7$(4),e.SpI(" ",t.departureDate," - "),e.R7$(3),e.SpI(" ",t.departureTime,""),e.R7$(4),e.E5c(" ",t.vehicleBrand," ",t.vehicleLine," (",t.vehicleModel,")"),e.R7$(4),e.SpI(" ",t.availableSeats,""),e.R7$(4),e.SpI(" ",t.startLocation,""),e.R7$(4),e.SpI(" ",t.endLocation,""),e.R7$(),e.Mz_("id","map-",o,""),e.R7$(4),e.FS9("max",t.availableSeats),e.R50("ngModel",t.neededSeats),e.R7$(),e.Y8G("disabled",!t.neededSeats||t.neededSeats<=0||t.neededSeats>t.availableSeats)}}function b(n,d){if(1&n&&(e.j41(0,"ion-list"),e.DNE(1,M,40,15,"ion-item",3),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.routes)}}function j(n,d){1&n&&(e.j41(0,"ion-label"),e.EFF(1,"No se encontraron rutas."),e.k0s())}const C=[{path:"",component:(()=>{class n{constructor(t,o,i,s){this.route=t,this.generalService=o,this.navCtrl=i,this.appComponent=s,this.routes=[],this.maps=[],this.directionsServices=[],this.directionsRenderers=[],this.userId=null,this.notificationMessage="",this.notificationType="info",this.isNotificationVisible=!1,this.geocoder=new google.maps.Geocoder}ngOnInit(){console.log("Buscando rutas...");const t=sessionStorage.getItem("userData");if(console.log("Datos del usuario:",t),t){const o=JSON.parse(t);this.userId=o.userId,console.log("User ID:",this.userId)}this.route.queryParams.subscribe(o=>{o.routes&&(this.routes=JSON.parse(o.routes),this.routes.forEach(i=>{this.getPlaceNameFromCoordinates(i.latitudeStartPoint,i.longitudeStartPoint,"startLocation",i),this.getPlaceNameFromCoordinates(i.latitudeEndPoint,i.longitudeEndPoint,"endLocation",i),console.log("OBTENIENDO CALIFICACION"),this.generalService.get("api/qualifications/route/"+i.routeId).subscribe({next:s=>{console.log("calificacion encontrada:",s),i.calificacion=s.averageScore},error:s=>{i.calificacion=0,console.log("Error al obtener calificacion de la ruta "+i)}})}))})}ngAfterViewInit(){setTimeout(()=>{this.routes.forEach((t,o)=>{this.initMap(o,t.latitudeStartPoint,t.longitudeStartPoint,t.latitudeEndPoint,t.longitudeEndPoint)})},500)}initMap(t,o,i,s,m){const c=document.getElementById(`map-${t}`);if(c){const l=new google.maps.Map(c,{center:{lat:o,lng:i},zoom:12}),F=new google.maps.DirectionsService,h=new google.maps.DirectionsRenderer;h.setMap(l);const T={origin:{lat:o,lng:i},destination:{lat:s,lng:m},travelMode:google.maps.TravelMode.DRIVING};F.route(T,(y,E)=>{E===google.maps.DirectionsStatus.OK?h.setDirections(y):console.error("Error al trazar la ruta:",E)}),this.maps[t]=l,this.directionsServices[t]=F,this.directionsRenderers[t]=h}}getPlaceNameFromCoordinates(t,o,i,s){const m={lat:parseFloat(t+""),lng:parseFloat(o+"")};this.geocoder.geocode({location:m},(c,l)=>{"OK"===l&&c[0]?s[i]=c[0].formatted_address:(console.error("Error al obtener el nombre del lugar:",l),s[i]=`${t}, ${o}`)})}validateSeats(t){t.isValidSeats=t.neededSeats&&t.neededSeats>0&&t.neededSeats<=t.availableSeats}requestTrip(t){console.log("Solicitando viaje:",t),console.log("Usuario autenticado:",this.userId);const o={startPoints:`${t.latitudeStartPoint}, ${t.longitudeStartPoint}`,endPoints:`${t.latitudeEndPoint}, ${t.longitudeEndPoint}`,neededSeats:t.neededSeats,tripStart:S().format("YYYY-MM-DDTHH:mm:ss"),tripEnd:S().add(30,"minutes").format("YYYY-MM-DDTHH:mm:ss"),FK_userId:this.userId,FK_routeId:t.routeId};this.generalService.post("api/createTrip",o).subscribe({next:i=>{i.success?(console.log("Viaje solicitado exitosamente",i),this.appComponent.showNotification("Correcto","success"),this.navCtrl.navigateRoot("/inicio",{queryParams:{notificationMessage:"Viaje Solicitado Exitosamente, El conductor ser\xe1 notificado y se pondr\xe1 en contacto contigo.",notificationType:"success"}})):(console.error("Error al solicitar el viaje",i),this.showNotification("Error al solicitar el viaje","error"))},error:i=>{console.error("Error al solicitar el viaje",i)}})}showNotification(t,o){this.notificationMessage=t,this.notificationType=o,this.isNotificationVisible=!0,setTimeout(()=>{this.isNotificationVisible=!1},6e3)}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(p.nX),e.rXU(v.O),e.rXU(P.q9),e.rXU(I.Z))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-search-results"]],decls:4,vars:5,consts:[[1,"ion-padding"],[3,"message","type","isVisible"],[4,"ngIf"],[4,"ngFor","ngForOf"],[2,"height","200px",3,"id"],["position","floating"],["type","number","min","1","placeholder","1",3,"ngModelChange","ngModel","max"],["expand","full","color","primary",3,"click","disabled"]],template:function(o,i){1&o&&(e.j41(0,"ion-content",0),e.nrm(1,"app-notification",1),e.DNE(2,b,2,1,"ion-list",2)(3,j,2,0,"ion-label",2),e.k0s()),2&o&&(e.R7$(),e.Y8G("message",i.notificationMessage)("type",i.notificationType)("isVisible",i.isNotificationVisible),e.R7$(),e.Y8G("ngIf",i.routes.length>0),e.R7$(),e.Y8G("ngIf",0===i.routes.length))},dependencies:[g.Sq,g.bT,u.BC,u.vS,a.Jm,a.b_,a.I9,a.ME,a.tN,a.W9,a.$w,a.uz,a.he,a.nf,a.su,a.T6,a.jL,R.z],styles:["ion-content[_ngcontent-%COMP%]{background-color:#1e1e1e}ion-card[_ngcontent-%COMP%]{background-color:#6c6b6b;border-radius:10px;color:#fff;box-shadow:0 4px 6px #00000080}ion-card-header[_ngcontent-%COMP%], ion-card-title[_ngcontent-%COMP%], ion-card-content[_ngcontent-%COMP%]{color:#fff}.route-map[_ngcontent-%COMP%]{border-radius:5px;overflow:hidden;margin-top:10px}ion-button[_ngcontent-%COMP%]{margin-top:15px;background-color:#f90;color:#fff}"]})}return n})()}];let $=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#i=this.\u0275inj=e.G2t({imports:[p.iI.forChild(C),p.iI]})}return n})();var N=r(3887);let D=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#i=this.\u0275inj=e.G2t({imports:[g.MD,u.YN,a.bv,$,N.G]})}return n})()}}]);